/*
 * ifttt.c
 *
 *  Created on: Sep 26, 2018
 *  Author: Agustin G. Gimeno (AGG)
 */


/****************************************************************************************************//**
*
* @file		esp8266.c
* @brief
* @version	1.00
* @date		XX/XX/XXXX
* @author	Agustin G. Gimeno (AGG)
*
*
*********************************************************************************************************
*** REVISION HISTORY
*
********************************************************************************************************/

/********************************************************************************************************
*** INCLUDES
********************************************************************************************************/
#include "string.h"
#include "stdint.h"
#include "stdio.h"
#include "My_Types.h"
#include "esp8266.h"
#include "ifttt.h"
#include "ifttt_cfg.h"
/********************************************************************************************************
*** PRIVATE DEFINES
********************************************************************************************************/
#define IFTTT_POST 	"POST /trigger/%s/with/key/%s HTTP/1.1\r\nContent-Type: application/json\r\ncache-control: no-cache\r\nUser-Agent: PostmanRuntime/7.1.1\r\nAccept: */*\r\nHost: maker.ifttt.com\r\ncontent-length: %d\r\nConnection: keep-alive\r\n\r\n%s"
#define IFTTT_POST_PAYLOAD "{ \"value1\" : \"%d\", \"value2\" : \"%d\", \"value3\" : \"%d\" }"
/********************************************************************************************************
*** PRIVATE MACROS
********************************************************************************************************/

/********************************************************************************************************
*** PRIVATE DATA TYPES
********************************************************************************************************/

/********************************************************************************************************
*** PUBLIC GLOBAL VARIABLES
********************************************************************************************************/

/********************************************************************************************************
*** PRIVATE GLOBAL VARIABLES
********************************************************************************************************/
static const char* events[EVENT_MAX_NUM] = {
	#undef EVENT
	#define EVENT(id, eventName) eventName,
	EVENT_TABLE
	#undef EVENT
};
/********************************************************************************************************
*** PRIVATE FUNCTION PROTOTYPES
********************************************************************************************************/

/********************************************************************************************************
*** CONFIGURATION ERRORS
********************************************************************************************************/

/********************************************************************************************************
*** MODULE FUNCTIONS
********************************************************************************************************/
void IFTTT_write(ifttt_event_id event, int value1, int value2, int value3){
	char post_payload[128];
	char post[512];
	sprintf(post_payload, IFTTT_POST_PAYLOAD, value1, value2, value3);
	sprintf(post, IFTTT_POST, events[event], IFTTT_SECRET_KEY, strlen(post_payload), post_payload);
	printf(post);
	ESP_TCPSend(IFTTT_HOST, IFTTT_PORT, post);
}
/********************************************************************************************************
*** INTERNAL MODULE FUNCTIONS
********************************************************************************************************/

/*-----------------------------------------------------------------------------------------------------*/

